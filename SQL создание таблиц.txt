-- 1. Roles
CREATE TABLE Roles (
    RoleId INT IDENTITY(1,1) PRIMARY KEY,
    RoleName NVARCHAR(50) NOT NULL UNIQUE
);

-- 2. Users
CREATE TABLE Users (
    UserId INT IDENTITY(1,1) PRIMARY KEY,
    Login NVARCHAR(50) NOT NULL UNIQUE,
    PasswordHash NVARCHAR(255) NOT NULL,
    RoleId INT NOT NULL,
    CONSTRAINT FK_Users_Roles
        FOREIGN KEY (RoleId) REFERENCES Roles(RoleId)
);

-- 3. Departments
CREATE TABLE Departments (
    DepartmentId INT IDENTITY(1,1) PRIMARY KEY,
    DepartmentName NVARCHAR(100) NOT NULL UNIQUE
);

-- 4. Groups
CREATE TABLE Groups (
    GroupId INT IDENTITY(1,1) PRIMARY KEY,
    GroupName NVARCHAR(50) NOT NULL UNIQUE,
    DepartmentId INT NOT NULL,
    CONSTRAINT FK_Groups_Departments
        FOREIGN KEY (DepartmentId) REFERENCES Departments(DepartmentId)
);

-- 5. Students
CREATE TABLE Students (
    StudentId INT IDENTITY(1,1) PRIMARY KEY,
    UserId INT NOT NULL UNIQUE,
    FirstName NVARCHAR(50) NOT NULL,
    LastName NVARCHAR(50) NOT NULL,
    BirthDate DATE NOT NULL,
    GroupId INT NOT NULL,
    CONSTRAINT FK_Students_Users
        FOREIGN KEY (UserId) REFERENCES Users(UserId),
    CONSTRAINT FK_Students_Groups
        FOREIGN KEY (GroupId) REFERENCES Groups(GroupId)
);

-- 6. Teachers
CREATE TABLE Teachers (
    TeacherId INT IDENTITY(1,1) PRIMARY KEY,
    UserId INT NOT NULL UNIQUE,
    FirstName NVARCHAR(50) NOT NULL,
    LastName NVARCHAR(50) NOT NULL,
    DepartmentId INT NOT NULL,
    CONSTRAINT FK_Teachers_Users
        FOREIGN KEY (UserId) REFERENCES Users(UserId),
    CONSTRAINT FK_Teachers_Departments
        FOREIGN KEY (DepartmentId) REFERENCES Departments(DepartmentId)
);

-- 7. Subjects
CREATE TABLE Subjects (
    SubjectId INT IDENTITY(1,1) PRIMARY KEY,
    SubjectName NVARCHAR(100) NOT NULL UNIQUE
);

-- 8. Courses (кто, что и какой группе преподаёт)
CREATE TABLE Courses (
    CourseId INT IDENTITY(1,1) PRIMARY KEY,
    SubjectId INT NOT NULL,
    TeacherId INT NOT NULL,
    GroupId INT NOT NULL,
    Semester INT NOT NULL,
    CONSTRAINT FK_Courses_Subjects
        FOREIGN KEY (SubjectId) REFERENCES Subjects(SubjectId),
    CONSTRAINT FK_Courses_Teachers
        FOREIGN KEY (TeacherId) REFERENCES Teachers(TeacherId),
    CONSTRAINT FK_Courses_Groups
        FOREIGN KEY (GroupId) REFERENCES Groups(GroupId)
);

-- 9. Enrollments (студенты на курсах)
CREATE TABLE Enrollments (
    EnrollmentId INT IDENTITY(1,1) PRIMARY KEY,
    StudentId INT NOT NULL,
    CourseId INT NOT NULL,
    CONSTRAINT UQ_Student_Course UNIQUE (StudentId, CourseId),
    CONSTRAINT FK_Enrollments_Students
        FOREIGN KEY (StudentId) REFERENCES Students(StudentId),
    CONSTRAINT FK_Enrollments_Courses
        FOREIGN KEY (CourseId) REFERENCES Courses(CourseId)
);

-- 10. Grades
CREATE TABLE Grades (
    GradeId INT IDENTITY(1,1) PRIMARY KEY,
    EnrollmentId INT NOT NULL,
    GradeValue INT NOT NULL CHECK (GradeValue BETWEEN 1 AND 5),
    GradeDate DATE NOT NULL DEFAULT GETDATE(),
    CONSTRAINT FK_Grades_Enrollments
        FOREIGN KEY (EnrollmentId) REFERENCES Enrollments(EnrollmentId)
);
